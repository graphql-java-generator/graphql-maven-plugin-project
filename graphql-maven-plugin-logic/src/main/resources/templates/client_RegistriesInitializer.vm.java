/** Generated by the '${templateName}' default template from graphql-java-generator (${templateFile}) */
##
## Maven ignores the default value for springBeanSuffix, and replaces it by a null value. In this case, we replace the value by an empty String 
#if (!$configuration.springBeanSuffix) #set($springBeanSuffix="") #else #set($springBeanSuffix = ${configuration.springBeanSuffix}) #end
##
package ${packageUtilName};

import com.graphql_java_generator.client.CustomScalarRegistryImpl;
import com.graphql_java_generator.client.directive.Directive;
import com.graphql_java_generator.client.directive.DirectiveLocation;
import com.graphql_java_generator.client.directive.DirectiveRegistry;
import com.graphql_java_generator.client.directive.DirectiveRegistryImpl;
import com.graphql_java_generator.client.request.InputParameter;
import com.graphql_java_generator.customscalars.GraphQLScalarTypeIDClient;

public class RegistriesInitializer {

	private static boolean initialized = false;

	public static void initializeAllRegistries() {
		if (!initialized) {
			initCustomScalarRegistry();
			initDirectiveRegistry();
			GraphQLTypeMappingImpl.initGraphQLTypeMappingRegistry();
			initialized = true;
		}
	}

	/**
	 * Initialization of the {@link DirectiveRegistry} with all directives defined in the current schema
	 */
	private static void initDirectiveRegistry() {
		DirectiveRegistryImpl.registerDirectiveRegistry("$springBeanSuffix", (directiveRegistry) -> {
			Directive directive;

#foreach ($directive in $directives)
			/////////////////////////////////////////////////////////////////////////////////////////////////////
			// Creating Directive ${directive.name}
			/////////////////////////////////////////////////////////////////////////////////////////////////////
			directive = new Directive("$springBeanSuffix");
			directive.setName("${directive.name}"); //$NON-NLS-1$
			directive.setPackageName("${packageUtilName}"); //$NON-NLS-1$
#foreach ($argument in $directive.arguments)
			directive.getArguments().add(
					InputParameter.newHardCodedParameter(
							"$springBeanSuffix", "${argument.name}", null, "${argument.graphQLTypeSimpleName}", ${argument.fieldTypeAST.mandatory}, ${argument.fieldTypeAST.listDepth}, ${argument.fieldTypeAST.itemMandatory})); //$NON-NLS-1$ //$NON-NLS-2$ //$NON-NLS-3$
#end
#foreach ($location in $directive.directiveLocations)
			directive.getDirectiveLocations().add(DirectiveLocation.${location.name()});
#end
			directiveRegistry.registerDirective(directive);

#end
		});
	}

	/**
	 * Initialization of the {@link registry} with all known custom scalars, that is with all custom scalars
	 * defined in the project pom
	 */
	private static void initCustomScalarRegistry() {
		CustomScalarRegistryImpl.registerCustomScalarRegistry("$springBeanSuffix", (registry) -> { //$NON-NLS-1$

#if ($isPluginModeClient)
			// Registering the ID parser, for client mode
			registry.registerGraphQLScalarType("ID", GraphQLScalarTypeIDClient.ID, String.class); //$NON-NLS-1$
#else
			// Registering the ID parser, for server mode
			registry.registerGraphQLScalarType("ID", GraphQLScalarTypeIDServer.ID, ${configuration.javaTypeForIDType}.class); //$NON-NLS-1$
#end

#foreach ($customScalar in $customScalars)
#if (${customScalar.customScalarDefinition.graphQLScalarTypeClass})
			registry.registerGraphQLScalarType("${customScalar.name}", new ${customScalar.customScalarDefinition.graphQLScalarTypeClass}(), ${customScalar.customScalarDefinition.javaType}.class); //$NON-NLS-1$
#elseif (${customScalar.customScalarDefinition.graphQLScalarTypeStaticField})
			registry.registerGraphQLScalarType("${customScalar.name}", ${customScalar.customScalarDefinition.graphQLScalarTypeStaticField}, ${customScalar.customScalarDefinition.javaType}.class); //$NON-NLS-1$
#elseif (${customScalar.customScalarDefinition.graphQLScalarTypeGetter})
			registry.registerGraphQLScalarType("${customScalar.name}", ${customScalar.customScalarDefinition.graphQLScalarTypeGetter}, ${customScalar.customScalarDefinition.javaType}.class); //$NON-NLS-1$
#else
			registry.registerGraphQLScalarType: ${customScalar.name} : you must define one of graphQLScalarTypeClass, graphQLScalarTypeStaticField or graphQLScalarTypeGetter (in the POM parameters for CustomScalars)
#end
#end
		});
	}
}